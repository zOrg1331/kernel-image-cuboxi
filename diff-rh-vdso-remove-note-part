Subject: [PATCH rhel5] VDSO: remove "note" section
From: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date: Mon, 14 Feb 2011 16:27:44 +0300
To: Pavel Emelianov <xemul@parallels.com>
CC: "vzlin-dev@lists.sw.ru" <vzlin-dev@lists.sw.ru>
Message-ID: <20110214132623.29253.60118.stgit@localhost6.localdomain6>

https://jira.sw.ru/browse/PSBM-6875

Fedora 14 and friend Glibc uses VDSO to obtain kernel version and stops
execution for VDSO syscalls if kernel this verison is below 2.6.32. We can't
easely change this VDSO kernel version since it's builtin. So we just remove
this version section from kernel build. In this case Glibc will use
"/proc/sys/kernel/osrelease".

Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>

---
 arch/x86_64/vdso/Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)


diff-vdso-remove-note.patch

diff --git a/arch/x86_64/vdso/Makefile b/arch/x86_64/vdso/Makefile
index 3cb986f..7496d93 100644
--- a/arch/x86_64/vdso/Makefile
+++ b/arch/x86_64/vdso/Makefile
@@ -4,7 +4,7 @@
 
 # files to link into the vdso
 # vdso-start.o has to be first
-vobjs-y := vdso-start.o vdso-note.o vclock_gettime.o vgetcpu.o vvar.o
+vobjs-y := vdso-start.o vclock_gettime.o vgetcpu.o vvar.o
 
 # files to link into kernel
 obj-y := vma.o vdso.o vdso-syms.o
