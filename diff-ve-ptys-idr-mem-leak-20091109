diff --git a/kernel/ve/vecalls.c b/kernel/ve/vecalls.c
index bd30877..2bf2771 100644
--- a/kernel/ve/vecalls.c
+++ b/kernel/ve/vecalls.c
@@ -2158,6 +2158,8 @@ static void free_ve_tty_drivers(struct ve_struct* ve)
 #ifdef CONFIG_UNIX98_PTYS
 	free_ve_tty_driver(ve->ptm_driver);
 	free_ve_tty_driver(ve->pts_driver);
+	if (ve->allocated_ptys)
+		idr_destroy(ve->allocated_ptys);
 	kfree(ve->allocated_ptys);
 	ve->ptm_driver = ve->pts_driver = NULL;
 	ve->allocated_ptys = NULL;
