From: Tetsu Yamamoto <tyamamot@redhat.com>
Date: Mon, 21 Jan 2008 20:48:27 -0500
Subject: [ia64] xen: create 100GB mem guest, fix softlockup
Message-id: 20080121165214.15518.13651.sendpatchset@dhcp83-164.boston.redhat.com
O-Subject: [RHEL5.2 PATCH 3/4][Take2] Cannot create guest having 100GB memory on Xen-ia64
Bugzilla: 251353

Acked-by: Bill Burns <bburns@redhat.com>
Acked-by: "Stephen C. Tweedie" <sct@redhat.com>

diff --git a/arch/ia64/xen/hypervisor.c b/arch/ia64/xen/hypervisor.c
index 48cfa61..6224ca8 100644
--- a/arch/ia64/xen/hypervisor.c
+++ b/arch/ia64/xen/hypervisor.c
@@ -724,6 +724,7 @@ xen_ia64_privcmd_vma_close(struct vm_area_struct* vma)
 
 	for (i = 0; i < privcmd_vma->num_entries; i++) {
 		xen_ia64_privcmd_entry_close(privcmd_range, entry_offset + i);
+		cond_resched();
 	}
 	vma->vm_private_data = NULL;
 	kfree(privcmd_vma);
